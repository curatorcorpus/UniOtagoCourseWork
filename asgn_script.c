#pragma config(Sensor, S3,     Colour,         sensorEV3_Color, modeEV3Color_Color)
#pragma config(Motor,  motorB,          left,          tmotorEV3_Large, PIDControl, driveLeft, encoder)
#pragma config(Motor,  motorC,          right,         tmotorEV3_Large, PIDControl, driveRight, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

// Colours range from 0 to 7
// None    = 0
// Black   = 1
// Blue    = 2
// Green   = 3
// Yellow  = 4
// Red     = 5
// White   = 6
// Brown   = 7

void initial_step(int initial_rot, int speed)
{
	forward(1, rotations, 50);
}

void inital_rot(){
	turnRight(quantity, unitType, speed);
	displayCenteredBigTextLine(4, "rotating");
}

void turn_wheels(int motor_pow)
{
	motor[motorB] = motor_pow;
	motor[motorC] = motor_pow;
}

// main task
task main(){

	// movement parameters
	int speed = 20;
	int initial_rot = 2; //TODO: needs to be configured for our environment

	int black_count = 0;
	int motor_pow = 40;

	bool on_track = false; // can set to true to test second if
	bool hasRotated = false; // can set to true to test second if
	bool firstBlack = false;

	short currentColour;

	// initial movement from start tile to black line
	initial_step(initial_rot, speed); // TODO: needs to be configured for our environment
	inital_rot();

	while (true){

		if(on_track && hasRotated) { // This equals true after first rotation
			turn_wheels(motor_pow);
			currentColour = SensorValue[Colour];

			if(currentColour == 1) {
				if(!firstBlack && black_count < 15){
					displayCenteredBigTextLine(4, "black");
					black_count++;
					playTone(200,20);
					firstBlack = true;
					} else if (black_count == 15) {
					displayCenteredBigTextLine(4, "15 reached");
					on_track = false;
				}

			} else {
				displayCenteredBigTextLine(4, "not");
				firstBlack = false;
			}

			sleep(100); // Wait 100 ms to get 50 readings per second
		}

		if(!on_track && hasRotated) { // This equals true after second rotation
			displayCenteredBigTextLine(4, "rotate now");
			turn_wheels(0);
		}
	}
}
